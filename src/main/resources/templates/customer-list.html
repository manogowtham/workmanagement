<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer List</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
/* Custom colors to match existing style */
.navbar-custom {
  background-color: #1a1a2e !important;
  padding: 0.5rem 1rem;
}

.navbar-custom .container-fluid {
  justify-content: space-between;
}

.navbar-custom .navbar-brand {
  color: white !important;
  font-size: 24px;
  font-weight: bold;
}

.navbar-custom .navbar-nav {
  margin-right: 0 !important;
}

.navbar-custom .navbar-collapse {
  justify-content: flex-end;
}

.navbar-custom .navbar-nav .nav-link {
  color: white !important;
  margin-right: 5px;
  padding: 8px 10px !important;
}

.navbar-custom .navbar-nav .nav-link:hover {
  color: #ccc !important;
}

.nav-button {
  padding: 8px 20px;
  background-color: #2c5364;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.nav-button:hover {
  background-color: #203a43;
}

.navbar-custom .navbar-toggler {
  border-color: rgba(255,255,255,0.3);
}

.navbar-custom .navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
}

.dropdown-menu {
  background-color: #1a1a2e;
  border: 1px solid #2c5364;
}

.dropdown-menu .dropdown-item {
  color: #ffffffcc;
  padding: 10px 16px;
}

.dropdown-menu .dropdown-item:hover {
  background-color: #203a43;
  color: white;
}

footer {
  background-color: #1a1a2e;
  color: white;
  text-align: center;
  padding: 0;
  position: relative;
  bottom: 0;
  height: 40px;
  line-height: 40px;
  width: 100%;
  margin-top: 20px;
}

/* Custom button styles to restore original colors */
.btn-custom-primary {
  background-color: #2c5364;
  border-color: #2c5364;
  color: white;
  padding: 8px 20px;
  border-radius: 5px;
}

.btn-custom-primary:hover {
  background-color: #203a43;
  border-color: #203a43;
  color: white;
}

.btn-custom-secondary {
  background-color: #6c757d;
  border-color: #6c757d;
  color: white;
  padding: 8px 20px;
  border-radius: 5px;
}

.btn-custom-secondary:hover {
  background-color: #5a6268;
  border-color: #545b62;
  color: white;
}

/* Custom table header styling */
.table-custom thead th {
  background-color: #2c5364;
  color: white;
  border-color: #2c5364;
}

/* Action button styling */
.btn-action {
  padding: 4px 12px;
  font-size: 12px;
  margin: 2px;
}

/* Search and Filter Container */
.search-filter-container {
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}

.search-filter-container .form-control {
  width: 200px;
}

.search-filter-container .btn {
  white-space: nowrap;
}

/* Navigation container */
.navigation-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 20px 0;
  flex-wrap: wrap;
  gap: 10px;
}

/* Pagination wrapper */
.pagination-wrapper {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

/* Custom pagination styling */
.pagination-custom {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  gap: 8px;
}

.pagination-custom a {
  padding: 6px 12px;
  border: 1px solid #2c5364;
  color: #2c5364;
  text-decoration: none;
  border-radius: 4px;
  font-weight: bold;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.pagination-custom a:hover {
  background-color: #2c5364;
  color: white;
}

.pagination-custom a.active {
  background-color: #2c5364;
  color: white;
  pointer-events: none;
  cursor: default;
}

/* Go To Page form */
.pagination-wrapper form {
  display: flex;
  align-items: center;
  gap: 6px;
}

.pagination-wrapper form label {
  font-weight: 600;
}

.pagination-wrapper form input[type="number"] {
  width: 60px;
  padding: 4px 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.pagination-wrapper form button {
  padding: 6px 12px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.3s ease;
}

.pagination-wrapper form button:hover {
  background-color: #218838;
}

.pagination-wrapper form span {
  font-weight: 600;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .navigation-container {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }

  .pagination-wrapper {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
    width: 100%;
  }

  .pagination-custom {
    flex-wrap: wrap;
  }

  .pagination-custom a {
    padding: 5px 10px;
    font-size: 14px;
  }

  .pagination-wrapper form {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    width: 100%;
  }

  .pagination-wrapper form input[type="number"] {
    width: 100%;
    max-width: 120px;
  }

  .pagination-wrapper form button {
    width: 100%;
    max-width: 120px;
  }

  .pagination-wrapper form label,
  .pagination-wrapper form span {
    width: 100%;
  }

  .search-filter-container {
    flex-direction: column;
    align-items: stretch;
    max-width: 100%;
    padding: 10px;
  }

  .search-filter-container .form-control,
  .search-filter-container .btn {
    width: 100%;
    margin: 5px 0;
  }
}

h2 {
  text-align: center;
}
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-custom">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/images/banyan-logo.png.png" alt="Banyan Logo" style="height:40px; vertical-align: middle; margin-right: 10px;" />
      BANYAN Informatics
    </a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        
        <!-- Show Engineer link only if user has permission -->
        <li class="nav-item" sec:authorize="hasAuthority('ENGINEER_PAGE')">
          <a class="nav-link" href="/engineer-form">Engineer</a>
        </li>
        
        <!-- Show Customer link only if user has permission -->
        <li class="nav-item" sec:authorize="hasAuthority('CUSTOMER_PAGE')">
          <a class="nav-link" href="/customer-form">Customer</a>
        </li>
        
        <!-- Show Work Details link only if user has permission -->
        <li class="nav-item" sec:authorize="hasAuthority('DETAILS_PAGE')">
          <a class="nav-link" href="/details">Work Details</a>
        </li>
        
        <!-- Authorization dropdown for SUPERADMIN -->
        <li class="nav-item dropdown" sec:authorize="hasAuthority('SUPERADMIN')">
          <a class="nav-link dropdown-toggle" href="#" id="authDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Authorization
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" th:href="@{/manage-role-access}">Manage-Role-access</a></li>
            <li><a class="dropdown-item" th:href="@{/add-user}">Add User</a></li>
            <li><a class="dropdown-item" th:href="@{/time-management}">Time</a></li>
            <li><a class="dropdown-item" th:href="@{/activity-logs}">Activity Logs</a></li>
          </ul>
        </li>
        
        <li class="nav-item">
          <form th:action="@{/logout}" method="post" class="d-flex">
            <button type="submit" class="nav-button">Logout</button>
          </form>
        </li>
      </ul>
    </div>
  </div>
</nav>







  <h2>Customer List</h2>

  <div class="search-filter-container">
    <form th:action="@{/customer-list}" method="get" id="searchForm" class="d-flex align-items-center gap-2">
      <input type="text" name="search" placeholder="Search customers..." th:value="${search}" class="form-control" />
      <button type="submit" class="btn btn-custom-primary">Search</button>
      <button type="button" id="resetBtn" class="btn btn-custom-primary">Reset</button>
    </form>
    <button id="exportBtn" class="btn btn-custom-secondary">
      Export to Excel
    </button>
  </div>

  <div class="container-fluid">
    <div class="table-responsive">
      <table id="customerTable" class="table table-striped table-bordered table-custom">
        <thead>
          <tr>
            <th>Type of Vendor</th>
            <th>Company Name</th>
            <th>Contact Person</th>
            <th>Mobile</th>
            <th>Address</th>
            <th>Area</th>
            <th>State</th>
            <th>City</th>
            <th>Pincode</th>
            <th>GST Number</th>
            <th>Company Contact</th>
            <th>Email</th>
            <th>Date</th>
            <!-- Removed Regular column as per user request -->
           
            <th>Actions</th>
          </tr>
        </thead>
    <tbody>
      <tr th:each="customer : ${customers}">
        <td th:text="${customer.vendorType}"></td>
        <td th:text="${customer.companyName}"></td>
        <td th:text="${customer.contactPerson}"></td>
        <td th:text="${customer.mobileNumber}"></td>
        <td th:text="${customer.address}"></td>
        <td th:text="${customer.area}"></td>
        <td th:text="${customer.state}"></td>
        <td th:text="${customer.city}"></td>
        <td th:text="${customer.pincode}"></td>
        <td th:text="${customer.gstNumber}"></td>
        <td th:text="${customer.companyContact}"></td>
        
        <td th:text="${customer.email}"></td>
        <td th:text="${customer.date != null} ? ${#dates.format(customer.date, 'yyyy-MM-dd')} : ''"></td>
        <!-- Removed Regular column data as per user request -->
        
        
          <td>
            <!-- Only show Edit and Delete for SUPERADMIN -->
            <div th:if="${#authorization.expression('hasAuthority(''CUSTOMER_EDIT'')')}">
            <a  th:href="@{/editCustomer/{id}(id=${customer.id})}" class="btn btn-custom-primary btn-action">Edit</a>
            </div>
            <div th:if="${#authorization.expression('hasAuthority(''CUSTOMER_DELETE'')')}">
            <a  th:href="@{/deleteCustomer/{id}(id=${customer.id})}" class="btn btn-custom-secondary btn-action">Delete</a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    </div>
  </div>

  <div class="container-fluid">
    <div class="navigation-container">
      <!-- Back Button -->
      <div class="back-button-container">
        <a href="/customer-form" class="btn btn-custom-primary">← Back</a>
      </div>
    
      <!-- Pagination and Go To Page -->
      <div class="pagination-wrapper">
    
        <ul class="pagination-custom">
          <!-- Previous Button -->
          <li th:if="${currentPage > 0}">
            <a th:href="@{'/customer-list'(page=${currentPage - 1}, search=${search})}">&laquo; Previous</a>
          </li>
    
          <!-- Page Numbers -->
          <li th:each="i : ${#numbers.sequence((currentPage > 0 ? currentPage - 1 : 0), (currentPage + 1 < totalPages ? currentPage + 1 : totalPages - 1))}">
            <a th:href="@{'/customer-list'(page=${i}, search=${search})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? 'active' : ''"
               th:style="${i == currentPage} ? 'active-style' : ''">
            </a>
          </li>
    
          <!-- Next Button -->
          <li th:if="${currentPage < totalPages - 1}">
            <a th:href="@{'/customer-list'(page=${currentPage + 1}, search=${search})}">Next &raquo;</a>
          </li>
        </ul>
  
        <!-- Go To Page Form -->
        <form th:action="@{/customer-list}" method="get" onsubmit="return validatePageInput()" class="d-flex align-items-center gap-2">
          <label for="pageInput" class="form-label mb-0">Go to page:</label>
          <input type="number" id="pageInput" name="page" min="0" required class="form-control" style="width: 80px;" />
          <button type="submit" class="btn btn-success">Go</button>
          <span class="fw-bold">Total Pages: <strong th:text="${totalPages}"></strong></span>
          <input type="hidden" name="search" th:value="${search}" />
        </form>
    
      </div>
    </div>
  </div>
<div> <footer>
    &copy; 2005 Banyan Informatics. All rights reserved.
  </footer></div>
 
  <script>
   // No additional navbar JavaScript needed - Bootstrap handles it
</script>
  <script>
document.getElementById('exportBtn').addEventListener('click', function() {
    const searchValue = encodeURIComponent(document.querySelector('input[name="search"]').value.trim());
    const exportUrl = `/export-customers?search=${searchValue}`;
    window.location.href = exportUrl; // triggers file download with search filter applied
  });

document.getElementById('resetBtn').addEventListener('click', function() {
    const searchInput = document.querySelector('input[name="search"]');
    searchInput.value = '';
    // Reset pagination to first page by clearing page input if exists
    const pageInput = document.querySelector('input[name="page"]');
    if (pageInput) {
        pageInput.value = '';
    }
    // Submit the form
    const form = document.querySelector('form[th\\:action="@{/customer-list}"]');
    if (form) {
        form.submit();
    }
});
</script>
  <script th:inline="javascript">
  function validatePageInput() {
    const pageInput = document.getElementById('pageInput');
    if (!pageInput.value) return false;
    
    let val = parseInt(pageInput.value);
    const totalPages = /*[[${totalPages}]]*/ 1;
    if (isNaN(val) || val < 1 || val > totalPages) {
      alert('Please enter a page number between 1 and ' + totalPages);
      return false;
    }

    const page = val - 1; // Convert to 0-based index

    // Get search value from form input
    const search = document.querySelector('input[name="search"]').value;

    // Build query params
    let query = `?page=${page}`;
    if (search) query += `&search=${encodeURIComponent(search)}`;

    // Redirect with search and page
    window.location.href = '/customer-list' + query;
    return false; // prevent default form submission
  }
</script>

<!-- Bootstrap JS and Popper.js for navbar toggle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
